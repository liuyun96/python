# encoding=utf8  

import urllib2
import re
import time
import json
from pyquery import PyQuery as pyq
import time
import sys
reload(sys)
sys.setdefaultencoding('utf-8')

def parse():
      headers = {
      }
      cates = {u'炫酷':'50000', u'简约':'50001', u'可爱':'50002', u'拟物':'50003', u'爱情':'50004', u'清新':'50005', u'扁平':'50006', u'美女':'50007', u'动漫':'50008', u'文艺':'50009'};
      fileHandle = open('d:/b.txt','w')
      for k in cates:
              page = 0;
              print k + str(page)
              # url = "http://api-theme.meizu.com/themes/public/search?os=19&mzos=4.0&screen_size=1080x1800&language=zh-CN&locale=cn&imei=864793020842337&sn=355BBJTNXU2R&device_model=M355&uid=10596254&v=2.1.0&vc=5&net=wifi&start=%s&max=30&q=%s" % (page,cates[k]);
              url = "net=wifi&start=%s&max=30&q=%s" % (page, str(k.encode('utf-8')));
              reqPv = urllib2.Request(
              url='http://api-theme.meizu.com/themes/public/search?os=19&mzos=4.0&screen_size=1080x1800&language=zh-CN&locale=cn&imei=864793020842337&sn=355BBJTNXU2R&device_model=M355&uid=10596254&firmware=Flyme%20OS%204.2.8.2A&v=2.1.0&vc=5&' + url,
              headers=headers)
              try:
                  json_data = urllib2.urlopen(reqPv).read()
                  #json_data = '{"code":200,"message":"","value":{"data":[{"evaluate_count":26,"id":2503493,"name":"最文艺","package_name":"com.meizu.theme.smartart","price":0,"promotion_price":null,"publisher":"可苦可乐","star":48,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/186/dd8407e48c5b4164962528e1f4c641cd.jpg","url":"/themes/public/detail/2503493","version_code":2},{"evaluate_count":14,"id":2734251,"name":"文艺范","package_name":"com.meizu.theme.wenyifan4.0","price":0,"promotion_price":null,"publisher":"半度团队","star":47,"tags":{"icon":""},"thumbnail":"http://c1.res.meizu.com/fileserver/theme/thumbnail/145/2e55b441096340b7a2b3a64949016936.jpg","url":"/themes/public/detail/2734251","version_code":1},{"evaluate_count":20,"id":2700145,"name":"文艺青年","package_name":"com.meizu.theme.wenyiqingnian","price":0,"promotion_price":null,"publisher":"牛奶妹","star":50,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/142/723cd461a2d34d0699e65094cdc5fdcd.jpg","url":"/themes/public/detail/2700145","version_code":1},{"evaluate_count":4,"id":2526193,"name":"素雅文艺","package_name":"com.meizu.theme.suyawenyi","price":3.99,"promotion_price":null,"publisher":"空白世界","star":43,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/916b6c61c05344339afa0e64ae1d56db.jpg","url":"/themes/public/detail/2526193","version_code":5},{"evaluate_count":0,"id":2630345,"name":"文艺中国风","package_name":"com.meizu.theme.wemyizhongguofengb","price":2.99,"promotion_price":null,"publisher":"SXT","star":0,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/5968d9a907d6482d9f68e29b2ea5f9ed.jpg","url":"/themes/public/detail/2630345","version_code":1},{"evaluate_count":10,"id":2627779,"name":"情侣之文艺姐","package_name":"com.meizu.theme.wyj","price":3,"promotion_price":null,"publisher":"苏闹闹","star":48,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/146/ad3928cfad6c4e0bb9ff9a2913486e16.jpg","url":"/themes/public/detail/2627779","version_code":6},{"evaluate_count":33,"id":2628087,"name":"文艺青年","package_name":"com.meizu.theme.bigee","price":2,"promotion_price":null,"publisher":"Leonardoo达芬奇","star":50,"tags":{"icon":"http://app.res.meizu.com/fileserver/label_icon/1/5ab5c4731181498fad69694eed0c7f1a.png"},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/9805bc8c0e8a4b30b6e62f228c9f1dcf.jpg","url":"/themes/public/detail/2628087","version_code":4},{"evaluate_count":0,"id":2626090,"name":"文艺范 寂寞空间","package_name":"com.meizu.theme.jimokongjian","price":2.99,"promotion_price":null,"publisher":"此用户无昵称","star":0,"tags":{"icon":""},"thumbnail":"http://a1.res.meizu.com/fileserver/thumbnail/188/296df66219fd4ece826adc17653815fa.jpg","url":"/themes/public/detail/2626090","version_code":7},{"evaluate_count":0,"id":2724988,"name":"小黄人文艺版","package_name":"com.meizu.theme.huangxiaomeng","price":1.99,"promotion_price":null,"publisher":"熙成","star":0,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/145/039225f04c2f496ea2a1a03ddb36f9f0.jpg","url":"/themes/public/detail/2724988","version_code":2},{"evaluate_count":448,"id":2724203,"name":"致青春二十七八岁","package_name":"com.meizu.theme.qingchun9","price":4.99,"promotion_price":null,"publisher":"优质设计","star":50,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/145/0fc45577c0d24f7ea15305ecae1ed796.jpg","url":"/themes/public/detail/2724203","version_code":1},{"evaluate_count":284,"id":2719012,"name":"深度-今年二十七八岁","package_name":"com.meizu.theme.ershiqi","price":3.98,"promotion_price":null,"publisher":"IStar OS","star":50,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/145/5b1b0bf8be8147cba71741f979bbb47f.jpg","url":"/themes/public/detail/2719012","version_code":2},{"evaluate_count":14,"id":2526209,"name":"海边","package_name":"com.meizu.theme.xtdf","price":0.1,"promotion_price":null,"publisher":"小鹏","star":48,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/4abf7d4ff7754dfc825fd25c02a827fe.jpg","url":"/themes/public/detail/2526209","version_code":7},{"evaluate_count":19,"id":2717825,"name":"时间都去哪了","package_name":"com.meizu.theme.shijian1","price":3.98,"promotion_price":null,"publisher":"Dr.W 工作室","star":50,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/145/a999d0ea8ca74a1cbd44ff45630bb6df.jpg","url":"/themes/public/detail/2717825","version_code":1},{"evaluate_count":391,"id":2050329,"name":"在回忆里等你","package_name":"com.meizu.theme.zhyldn","price":3.99,"promotion_price":null,"publisher":"樱花色瞳孔","star":49,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/186/b45b0d807781458597195119f37641c5.jpg","url":"/themes/public/detail/2050329","version_code":4},{"evaluate_count":181,"id":2631983,"name":"New York 之约","package_name":"com.meizu.theme.newyorkzhiyue","price":0,"promotion_price":null,"publisher":"Zunoe","star":47,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/0d17f854c55143e7a092815e504b52a6.jpg","url":"/themes/public/detail/2631983","version_code":3},{"evaluate_count":106,"id":2527992,"name":"魅圆线","package_name":"com.meizu.theme.myx","price":0,"promotion_price":null,"publisher":"默默","star":40,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/186/8a9efb54d6b94ee598a4aea428a8f773.jpg","url":"/themes/public/detail/2527992","version_code":1},{"evaluate_count":26,"id":2631180,"name":"等候","package_name":"com.meizu.theme.denghou","price":0,"promotion_price":null,"publisher":"Zunoe","star":48,"tags":{"icon":""},"thumbnail":"http://a1.res.meizu.com/fileserver/thumbnail/188/7aa641506be54a38905df71d82b15681.jpg","url":"/themes/public/detail/2631180","version_code":1},{"evaluate_count":411,"id":2526135,"name":"解密","package_name":"com.meizu.theme.jiemi1","price":0,"promotion_price":null,"publisher":"子洁","star":50,"tags":{"icon":"http://app.res.meizu.com/fileserver/label_icon/1/69e437a4602145b79a8339f449da5462.png"},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/186/061de2901b654edfb62d71476b418699.jpg","url":"/themes/public/detail/2526135","version_code":2},{"evaluate_count":25,"id":2397646,"name":"美图鉴赏","package_name":"com.meizu.theme.meitu","price":0,"promotion_price":null,"publisher":"凌非烟","star":43,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/0c09366230e14a678dd0454737991339.jpg","url":"/themes/public/detail/2397646","version_code":8},{"evaluate_count":133,"id":2296946,"name":"西瓜君","package_name":"com.meizu.theme.xgj","price":2,"promotion_price":null,"publisher":"苏闹闹","star":45,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/146/513cec430d1b4af9a33db04803a4ec74.jpg","url":"/themes/public/detail/2296946","version_code":18},{"evaluate_count":12,"id":2527332,"name":"中国风","package_name":"com.meizu.theme.ChineseStyle","price":0,"promotion_price":null,"publisher":"文行","star":43,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/04e960f612f940b99887c7cee070322e.jpg","url":"/themes/public/detail/2527332","version_code":1},{"evaluate_count":50,"id":2676183,"name":"英伦徽章风","package_name":"com.meizu.theme.Badgekarey","price":0,"promotion_price":null,"publisher":"Karey","star":39,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/cc740d10c15940ae94fd1aa5feadc03a.jpg","url":"/themes/public/detail/2676183","version_code":1},{"evaluate_count":24,"id":2704312,"name":"一个人的城市","package_name":"com.meizu.theme.YGRDCS","price":0,"promotion_price":null,"publisher":"Gyh","star":45,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/142/074beff41b89478cadf06b1b9df41fcf.jpg","url":"/themes/public/detail/2704312","version_code":1},{"evaluate_count":59,"id":2587272,"name":"清新氢","package_name":"com.meizu.theme.ying","price":0,"promotion_price":null,"publisher":"weiwei","star":48,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/9bdb04c77e6f4d35aa70f78b24e5f680.jpg","url":"/themes/public/detail/2587272","version_code":5},{"evaluate_count":31,"id":2566445,"name":"文字控","package_name":"com.meizu.theme.wzk0","price":0,"promotion_price":null,"publisher":"luli","star":41,"tags":{"icon":"http://app.res.meizu.com/fileserver/label_icon/1/69e437a4602145b79a8339f449da5462.png"},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/d06393b987a24592a675afc8325e6f8d.jpg","url":"/themes/public/detail/2566445","version_code":1},{"evaluate_count":8,"id":2598877,"name":"不列颠之恋","package_name":"com.meizu.theme.LONDON","price":0,"promotion_price":null,"publisher":"简文","star":44,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/30baee693073446b81fc3c4682e82006.jpg","url":"/themes/public/detail/2598877","version_code":7},{"evaluate_count":22,"id":2698743,"name":"旅行的意义","package_name":"com.meizu.theme.lxdyy","price":0,"promotion_price":null,"publisher":"linear","star":48,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/141/ddb112c007114f3ca7c9f00b7954220c.jpg","url":"/themes/public/detail/2698743","version_code":1},{"evaluate_count":16,"id":2531710,"name":"打篮球的男人们","package_name":"com.meizu.theme.lqfr","price":0,"promotion_price":null,"publisher":"景风蓝","star":46,"tags":{"icon":""},"thumbnail":"http://a1.res.meizu.com/fileserver/thumbnail/186/8f6b0e13f2b5462b9767d1d896c70d58.jpg","url":"/themes/public/detail/2531710","version_code":1},{"evaluate_count":44,"id":2524152,"name":"我是铁塔控","package_name":"com.meizu.theme.qingy","price":1.99,"promotion_price":null,"publisher":"小鹿","star":44,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/189/e74351bbe28e47759287b88dccfdd4e1.jpg","url":"/themes/public/detail/2524152","version_code":6},{"evaluate_count":26,"id":2634941,"name":"Ocean(谧夜)","package_name":"com.meizu.theme.OceanAWM","price":0,"promotion_price":null,"publisher":"张宇","star":48,"tags":{"icon":""},"thumbnail":"http://a1.res.meizu.com/fileserver/thumbnail/188/41ed6961679a43f1a792f13694e4275d.jpg","url":"/themes/public/detail/2634941","version_code":1},{"evaluate_count":32,"id":2633003,"name":"吹灭云朵","package_name":"com.meizu.theme.Blindalltheclouds","price":0,"promotion_price":null,"publisher":"Daisy","star":50,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/a0e2c2fb124d4cc19cba0f811e81a879.jpg","url":"/themes/public/detail/2633003","version_code":1},{"evaluate_count":14,"id":2720116,"name":"不要懒惰","package_name":"com.meizu.theme.buyaolanduo","price":0,"promotion_price":null,"publisher":"南极雪","star":47,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/145/3da5036a1b024409984d4cfcba67f573.jpg","url":"/themes/public/detail/2720116","version_code":1},{"evaluate_count":68,"id":2725501,"name":"古风","package_name":"com.meizu.theme.gufengg","price":0,"promotion_price":null,"publisher":"南极雪","star":46,"tags":{"icon":""},"thumbnail":"http://c1.res.meizu.com/fileserver/theme/thumbnail/145/54a74cd053b445d090afca7fee78c02b.jpg","url":"/themes/public/detail/2725501","version_code":1},{"evaluate_count":3,"id":2597481,"name":"轻生活-轨迹","package_name":"com.meizu.theme.QINGGUIJI","price":0,"promotion_price":null,"publisher":"_EVEN゛夜","star":44,"tags":{"icon":""},"thumbnail":"http://a1.res.meizu.com/fileserver/thumbnail/188/e25a7e988e7b4bdc80256309eec4673b.jpg","url":"/themes/public/detail/2597481","version_code":2},{"evaluate_count":18,"id":1972512,"name":"Have a nice day","package_name":"com.meizu.theme.aa","price":0,"promotion_price":null,"publisher":"木光","star":44,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/186/676e413538684d4c84c97f88edd9a93a.png","url":"/themes/public/detail/1972512","version_code":1},{"evaluate_count":4,"id":2711344,"name":"轻旅","package_name":"com.meizu.theme.qinglv","price":0,"promotion_price":null,"publisher":"mango","star":48,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/146/a80f8e37766e4f658b24992dabd3a66a.jpg","url":"/themes/public/detail/2711344","version_code":1},{"evaluate_count":5,"id":2537540,"name":"让我静一静","package_name":"com.meizu.theme.gudu","price":0,"promotion_price":null,"publisher":"睡不醒的蚂蚱","star":46,"tags":{"icon":""},"thumbnail":"http://a1.res.meizu.com/fileserver/thumbnail/189/9cb0718377ad45d683df1330cbf6a7c8.jpg","url":"/themes/public/detail/2537540","version_code":1},{"evaluate_count":136,"id":2689143,"name":"有一个梦想","package_name":"com.meizu.theme.0755","price":4.5,"promotion_price":3.99,"publisher":"怀念大海的烤鱼","star":50,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/145/8596e6ee2dba43db971ddf80c39cfb3e.jpg","url":"/themes/public/detail/2689143","version_code":4},{"evaluate_count":5,"id":2735649,"name":"梦幻的世界","package_name":"com.meizu.theme.menghuandeshijie","price":0,"promotion_price":null,"publisher":"美优原创","star":50,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/145/392474d9e61847b5a64bf6b3ec76beca.jpg","url":"/themes/public/detail/2735649","version_code":1},{"evaluate_count":10,"id":2672955,"name":"荧光","package_name":"com.meizu.theme.yingguang","price":0,"promotion_price":null,"publisher":"小叶子","star":49,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/e671db77a6a34c35b6203e3ab068028d.jpg","url":"/themes/public/detail/2672955","version_code":1},{"evaluate_count":32,"id":2626657,"name":"清新OS","package_name":"com.meizu.theme.shuya","price":2.99,"promotion_price":null,"publisher":"小鹏","star":46,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/145/9bd4b8c899014b148a8dcfb389bc96b3.jpg","url":"/themes/public/detail/2626657","version_code":9},{"evaluate_count":4,"id":2697898,"name":"恋之风景","package_name":"com.meizu.theme.0767","price":0,"promotion_price":null,"publisher":"怀念大海的烤鱼","star":38,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/142/749cc7b23f704434b0922476cbba0a9e.jpg","url":"/themes/public/detail/2697898","version_code":1},{"evaluate_count":7,"id":1990508,"name":"足迹","package_name":"com.meizu.theme.muyun","price":0,"promotion_price":null,"publisher":"WWQ35","star":46,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/145/af0fffc45c1c40bfb172f13ede8e3f22.jpg","url":"/themes/public/detail/1990508","version_code":24},{"evaluate_count":3,"id":2724800,"name":"橙","package_name":"com.meizu.theme.chengcheng","price":0,"promotion_price":null,"publisher":"mango","star":37,"tags":{"icon":""},"thumbnail":"http://c1.res.meizu.com/fileserver/theme/thumbnail/145/6d92bdc3ff024c0b89d4f22252e901f3.jpg","url":"/themes/public/detail/2724800","version_code":1},{"evaluate_count":6,"id":2728725,"name":"城市记忆—皱纸","package_name":"com.meizu.theme.12341","price":4.99,"promotion_price":null,"publisher":"蛋炒饭OL","star":39,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/145/8aefc37691a14536beb2731821fb5cbb.jpg","url":"/themes/public/detail/2728725","version_code":2},{"evaluate_count":8,"id":2632777,"name":"淡雅","package_name":"com.meizu.theme.dy00","price":0.5,"promotion_price":null,"publisher":"图图","star":39,"tags":{"icon":""},"thumbnail":"http://c2.res.meizu.com/fileserver/theme/thumbnail/141/06ba7cef92764b488053c0f559c53a2f.jpg","url":"/themes/public/detail/2632777","version_code":3},{"evaluate_count":1,"id":2630678,"name":"东北话之你瞅啥","package_name":"com.meizu.theme.dongbeihua","price":1.99,"promotion_price":null,"publisher":"Sanny","star":50,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/188/d2f23e9e7cfe4b32a929b346d65e2b0a.jpg","url":"/themes/public/detail/2630678","version_code":1},{"evaluate_count":2,"id":2527233,"name":"不提爱情[希柚美女π]","package_name":"com.meizu.theme.butiaiqing","price":1.99,"promotion_price":null,"publisher":"希柚","star":50,"tags":{"icon":""},"thumbnail":"http://app.res.meizu.com/fileserver/thumbnail/186/4eaf25f22c544a8db366fb1e4424486b.jpg","url":"/themes/public/detail/2527233","version_code":1},{"evaluate_count":0,"id":2625140,"name":"distant place","package_name":"com.meizu.theme.DP","price":2.99,"promotion_price":null,"publisher":"啊飞8","star":0,"tags":{"icon":""},"thumbnail":"http://a1.res.meizu.com/fileserver/thumbnail/188/195ed4599a754b21bcc7bee7f2a6e2d4.jpg","url":"/themes/public/detail/2625140","version_code":1}],"more":false}}';
                  data = json.loads(json_data);
                  # print data["code"];
                  if data["code"] == 200:
                      for value in data["value"]["data"]:
                          print value["evaluate_count"]
                          if value["evaluate_count"] != 0:
                             evaluate_url = "start=0&max=100&theme_id=%s" % (value["id"]);
                             reqPv = urllib2.Request(url='http://api-theme.meizu.com/themes/public/evaluate/list?os=19&mzos=4.0&screen_size=1080x1800&language=zh-CN&locale=cn&imei=864793020842337&sn=355BBJTNXU2R&device_model=M355&uid=10596254&firmware=Flyme%20OS%204.2.8.2A&v=2.1.0&vc=5&net=wifi&' + evaluate_url)
                             try:
                                 evaluate_json = urllib2.urlopen(reqPv).read()
                                 evaluate_data = json.loads(evaluate_json);
                                 if evaluate_data["code"] == 200:
                                    for value in evaluate_data["value"]["data"]:
                                        fileHandle.write (value["comment"])
                                        fileHandle.write (timestamp_datetime(float(str(value["create_time"])[0:10])))
                                        fileHandle.write (value["user_name"]+"\n")
                                        print value["comment"],
                                        #print timestamp_datetime(float(str(value["create_time"])[0:10])),
                                        #print value["user_name"]
                             except:
                                print sys.exc_info()[0],sys.exc_info()[1] 
              except:
                    print sys.exc_info()[0],sys.exc_info()[1]
      fileHandle.close()                      
def timestamp_datetime(value):
       format = '%Y-%m-%d %H:%M:%S';
        # value为传入的值为时间戳(整形)，如：1332888820
       value = time.localtime(value)
        ## 经过localtime转换后变成
        ## time.struct_time(tm_year=2012, tm_mon=3, tm_mday=28, tm_hour=6, tm_min=53, tm_sec=40, tm_wday=2, tm_yday=88, tm_isdst=0)
        # 最后再经过strftime函数转换为正常日期格式。
       dt = time.strftime(format, value)
       return dt;

if __name__ == '__main__':
    parse();
